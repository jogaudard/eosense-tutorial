---
title: "Comparison with eosAC-T/O"
---


```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(tidyverse.quiet = TRUE)
```


```{r}
#| label: "import-eos"


fluxes_eos_read <- read_csv("compare_data/chamber_data.csv")

fluxes_eos <- fluxes_eos_read |>
    mutate(
        date = as.Date(`Julian Day`, origin = as.Date("2024-01-01")),
        seconds = (`Julian Day` - floor(`Julian Day`)) * 24 * 3600,
        time = hms::as_hms(seconds),
        datetime = as_datetime(paste(date, time))
    ) |>
    select(datetime, everything())

# View(fluxes_eos)
```

```{r}
#| label: "gather"

fluxes_eos_id <- fluxes_eos |>
  filter(
    datetime > ymd_hms("2024-12-12 00:00:01")
  ) |>
  arrange(datetime) |>
  rowid_to_column("id")

fluxible_df_id <- fluxible_df |>
  filter(
    f_datetime > ymd_hms("2024-12-12 00:03:01")
  ) |>
  arrange(f_datetime) |>
  rowid_to_column("id")

comparison_fluxes <- left_join(fluxible_df_id, fluxes_eos_id, by = "id") |>
  rename(
    eos_flux = `Flux CO2 (E) (umol/m^2/s)`
  )

```


```{r}
#| label: fig-eosense
#| echo: false
#| message: FALSE
#| warning: false
#| fig-width: 10
#| fig-height: 8
#| fig-cap: ""

library(ggplot2)
library(ggpmisc)
library(viridis)
library(tidyverse)






plot_eos <- comparison_fluxes |>
    ggplot(aes(fluxible_flux, eos_flux, label = f_fluxid)) +
    theme_bw() +
    # scale_color_manual(values = c(
    #     Exponential = "#0c9f0b",
    #     Linear = "#bf28bd")
    # ) +
    # theme(legend.position = c(0.87, 0.25)) +
    # scale_fill_viridis(discrete = TRUE) +
    geom_point() +
    geom_text() +
    geom_abline(slope = 1, intercept = 0) +
    stat_poly_line() +
    stat_correlation(use_label("cor.label", "R2", "n"))
    # stat_poly_eq(use_label("R2", "n")) +
    # facet_wrap(gas ~ ., scales = "free", nrow = 2, labeller = as_labeller(gas_names)) +
    # labs(
    #     title = "Comparison of flux estimates between SoilFluxPro and Fluxible",
    #     x = "Fluxes calculated with Fluxible (exp_hm and linear model respectively)",
    #     y = "Fluxes as provided by LI-COR (calculated with SFP)",
    #     color = "Model"
    # )
plot_eos
```